<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="rgb(49, 49, 251)">
  <title>House Rental</title>
  <link rel="stylesheet" href="index.css">
  <!-- <link rel="stylesheet" href="scrollBar.css"> -->
  <!-- <style>
    /* Property card styles - added inline to ensure cards display properly */
    .properties {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .property-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      display: flex;
      flex-direction: column;
    }

    .property-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    /* Make the card styling exactly match properties.html */
    .property-image {
      position: relative;
      height: 200px;
      overflow: hidden;
    }

    .property-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: scale 0.3s ease;
    }

    .property-card:hover .property-image img {
      scale: 1.05;
    }

    .property-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #27ae60;
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }

    .property-info {
      padding: 20px;
    }

    .property-info h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 18px;
      margin-top: 0;
    }

    .property-details {
      display: grid;
      gap: 10px;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ecf0f1;
    }

    .detail-label {
      font-weight: 600;
      color: #34495e;
    }

    .detail-value {
      color: #2c3e50;
      font-weight: 500;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .properties {
        grid-template-columns: 1fr;
        padding: 10px;
      }
    } -->
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav>
    <div class="logo">
      <img title="Home" onclick="window.open('index.html')" src="https://img.freepik.com/premium-psd/modern-house-transparency-background-psd_693425-20565.jpg" alt="Logo" />
      House Rental
    </div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="Host.html">Rent out users</a>
      <a href="properties.html">Properties</a>
      <a href="about.html">About</a>
      <button onclick="window.open('client_signup.html')" class="circle-spinner-btn">Signup</button>
      <button onclick="window.open('client_login.html')" class="circle-spinner-btn">Login</button>
    </div>

    <div class="hamburger" id="hamburger">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </nav>

  <div class="side-nav" id="sideNav">
    <a href="index.html">Home</a>
    <a href="Host.html">Rent out users</a>
    <a href="properties.html">Properties</a>
    <a href="about.html">About</a>
    <a href="client_signup.html">Signup</a>
    <a href="client_login.html">Login</a>
  </div>

  <!-- Hero -->
  <header class="hero">
    <h1 class="typewriter">Find Your Perfect Home</h1>
    <div class="search-bar">
      <input type="text" id="searchInput" list="city" placeholder="Search for properties..." />
      <datalist id="city">
        <option value="Hyderabad">Hyderabad</option><option value="Delhi">Delhi</option><option value="Chennai">Chennai</option>
        <option value="Kerala">Kerala</option><option value="Banglore">Banglore</option><option value="kanada">Kanada</option>
        <option value="Vijayawada">Vijayawada</option><option value="Naidupet">Naidupet</option><option value="Mumbai">Mumbai</option>
        <option value="Tirupati">Tirupati</option>
      </datalist>
      <button id="searchBtn" class="circle-spinner-btn">Search</button>
    </div>
    <div class="advanced-search">
      <select id="propertyType" style="color:blue">
        <option value="">Property Type</option>
        <option value="apartment">Apartment</option>
        <option value="Townhouse">House</option>
        <option value="villa">Villa</option>
        <option value="duplex">Duplex</option>
      </select>
      <select id="priceRange" style="color:blue">
        <option value="">Price Range</option>
        <option value="$5000 - $10,000">$5000 - $10,000</option>
        <option value="$10,000 - $20,000">$10,000 - $20,000</option>
        <option value="$20,000+">$20,000+</option>
      </select>
      <select id="beds" style="color:blue">
        <option value="">Beds</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5+">5+</option>
      </select>
    </div>
  </header>

  <!-- Properties -->
  <h2>Featured Properties</h2>
  <div class="properties" id="propertyList"></div>

  <!-- Contact -->
 <section id="contact" class="contact-section">
    <h2>Contact Us</h2>
    <div class="contact-container con" style="position:relative">
        <form id="contactForm">
            <div class="container">
              <input id="name" type="text" name="username" placeholder=" " class="input" />
               <label for="name" class="user-Label">Your Name</label>
            </div>

            <div class="container">
              <input id="email" type="email" name="useremail" placeholder=" " class="input" />
              <label for="email" class="user-Label">Your Email</label>
            </div>

            <div class="container">
              <textarea id="message" name="message" placeholder=" " class="textarea" rows="4"></textarea>
              <label for="message" class="user-Label">Your Message</label>
            </div>

            <button type='button' onclick="formData()">Send Message</button>
        </form>
        <div id="messageDiv"></div>
    </div>
</section>
  <!-- Footer -->
  <footer>
    <p>&copy; 2025 House Rental. All rights reserved.</p>
  </footer>

  <!-- JavaScript -->
  <script>
    // Updated getCookie function to match the one in properties.html
    function getCookie(name) {
      const cookieArr = document.cookie.split("; ");
      for (let cookie of cookieArr) {
        const [key, val] = cookie.split("=");
        if (key === name) return decodeURIComponent(val);
      }
      return null;
    }

    // Modified function to handle property card clicks
    function addCardClickListeners() {
      const propertyCards = document.querySelectorAll(".property-card");
      
      propertyCards.forEach(card => {
        // Add click event with property information
        card.addEventListener("click", function() {
          // Get property name from the card
          const propertyName = this.querySelector("h3")?.innerText;
          
          // Check login status using both cookies
          const userEmail = getCookie("userEmail");
          const isLoggedIn = getCookie("isLoggedIn");
          
          if (!userEmail || isLoggedIn !== "true") {
            alert("Please log in to view the property details.");
            // Don't redirect, just show the alert
          } else {
            // User is logged in, navigate to property details
            window.location.href = `properties.html?house=${encodeURIComponent(propertyName || '')}`;
          }
        });
      });
    }

    let allData = [];
    let allProperties = []; // Store all properties for filtering

    async function fetchAndRenderProperties() {
      try {
        // First try loading from localStorage
        let data = [];
        let hasLocalData = false;
        
        // Loop through localStorage to find client data
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('client_')) {
            try {
              const clientData = JSON.parse(localStorage.getItem(key));
              if (clientData && clientData.rentouts) {
                data.push(clientData);
                hasLocalData = true;
              }
            } catch (error) {
              console.error("Error parsing localStorage data:", error);
            }
          }
        }
        
        // If no data in localStorage, use sample data
        if (!hasLocalData) {
          // Sample data structure that matches your expected format
      /*
          data = [
            {
              id: "sample1",
              rentouts: [
                {
                  houseName: "Modern Apartment",
                  location: "Hyderabad",
                  price: "15000",
                  beds: "2",
                  contact: "9876543210",
                  imageUrl: "https://res.cloudinary.com/demo/image/upload/sample.jpg"
                },
                {
                  houseName: "Luxury Villa",
                  location: "Bangalore",
                  price: "25000",
                  beds: "4",
                  contact: "9876543211",
                  imageUrl: "https://res.cloudinary.com/demo/image/upload/v1312461204/sample.jpg"
                }
              ]
            },
            {
              id: "sample2",
              rentouts: [
                {
                  houseName: "Cozy Studio",
                  location: "Mumbai",
                  price: "8000",
                  beds: "1",
                  contact: "9876543212",
                  imageUrl: "https://res.cloudinary.com/demo/image/upload/flowers.jpg"
                },
                {
                  houseName: "Family House",
                  location: "Delhi",
                  price: "18000",
                  beds: "3",
                  contact: "9876543213",
                  imageUrl: "https://res.cloudinary.com/demo/image/upload/w_500/v1473681911/samples/food/spices.jpg"
                },
                {
                  houseName: "Beach Villa",
                  location: "Chennai",
                  price: "22000",
                  beds: "5",
                  contact: "9876543214",
                  imageUrl: "https://res.cloudinary.com/demo/image/upload/sample.jpg"
                },
                {
                  houseName: "City Duplex",
                  location: "Kerala",
                  price: "12000",
                  beds: "3",
                  contact: "9876543215",
                  imageUrl: "https://res.cloudinary.com/demo/image/upload/v1312461204/sample.jpg"
                }
              ]
            }
          ];*/
          console.log("Using sample data since no local data found");
        }
        
        allData = data;
        
        // Extract all properties from clients
        allProperties = [];
        data.forEach(client => {
          if (client && client.rentouts && Array.isArray(client.rentouts)) {
            client.rentouts.forEach(property => {
              allProperties.push(property);
            });
          }
        });
        
        renderProperties(allProperties);
      } catch (err) {
        console.error("Error loading properties:", err);
        // Fallback to empty data array if everything fails
        renderProperties([]);
      }
    }

    // Display properties exactly like properties.html
    function renderProperties(properties) {
      const main = document.getElementById("propertyList");
      main.innerHTML = "";

      if (properties.length === 0) {
        main.innerHTML = `
          <div class="no-results" style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #7f8c8d;">
            <h3>No Properties Found</h3>
            <p>Try adjusting your search criteria.</p>
          </div>
        `;
        return;
      }

      // Filter properties based on search criteria
      const filteredProperties = properties.filter(property => propertyMatchesFilters(property));
      
      if (filteredProperties.length === 0) {
        main.innerHTML = `
          <div class="no-results" style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #7f8c8d;">
            <h3>No Matching Properties</h3>
            <p>Try adjusting your search criteria.</p>
          </div>
        `;
        return;
      }

      // Display up to 8 properties
      filteredProperties.slice(0, 8).forEach((property, index) => {
        const card = document.createElement("div");
        card.className = "property-card";
        card.setAttribute('title', 'View Details');

        // Handle missing image
        const imageUrl = property.imageUrl || '/api/placeholder/400/300';

        card.innerHTML = `
          <div class="property-image">
            <img src="${imageUrl}" alt="${property.houseName}" onerror="this.src='/api/placeholder/400/300'" />
            <div class="property-badge">Available</div>
          </div>
          <div class="property-info">
            <h3>${property.houseName}</h3>
            <div class="property-details">
              <div class="detail-item">
                <span class="detail-label">Rent:</span>
                <span class="detail-value">₹${Number(property.price).toLocaleString()}/Month</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Beds:</span>
                <span class="detail-value">${property.beds}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Contact:</span>
                <span class="detail-value">${property.contact || 'Contact Owner'}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Location:</span>
                <span class="detail-value">${property.location}</span>
              </div>
            </div>
          </div>
        `;

        main.appendChild(card);
      });

      addCardClickListeners(); // Add event listeners to the property cards
    }

    function propertyMatchesFilters(property) {
      const search = document.getElementById("searchInput").value.toLowerCase().trim();
      const type = document.getElementById("propertyType").value;
      const priceRange = document.getElementById("priceRange").value;
      const bedsValue = document.getElementById("beds").value;
      
      // Search filter - check both houseName and location
      let matchSearch = true;
      if (search) {
        matchSearch = (property.houseName && property.houseName.toLowerCase().includes(search)) || 
                      (property.location && property.location.toLowerCase().includes(search));
      }

      // Property type filter
      // Assuming the property name might be used as the property type if not specified
      let matchType = true;
      if (type) {
        const propertyTypeLower = (property.propertyType || property.houseName || "").toLowerCase();
        matchType = propertyTypeLower.includes(type.toLowerCase());
      }

      // Price range filter
      let matchPrice = true;
      if (priceRange && property.price) {
        // Extract numeric value from price string
        const priceNum = parseFloat(property.price.replace(/[^\d.]/g, ''));
        
        if (priceRange === "$5000 - $10,000") {
          matchPrice = priceNum >= 5000 && priceNum <= 10000;
        } else if (priceRange === "$10,000 - $20,000") {
          matchPrice = priceNum > 10000 && priceNum <= 20000;
        } else if (priceRange === "$20,000+") {
          matchPrice = priceNum > 20000;
        }
      }

      // Beds filter
      let matchBeds = true;
      if (bedsValue) {
        // Get beds value, checking for both possible property names
        const propertyBeds = property.beds || property.Beds;
        
        if (propertyBeds !== undefined) {
          if (bedsValue === "5+") {
            matchBeds = parseInt(propertyBeds) >= 5;
          } else {
            matchBeds = String(propertyBeds) === bedsValue;
          }
        } else {
          matchBeds = false; // If no beds data and filter is set, don't match
        }
      }

      return matchSearch && matchType && matchPrice && matchBeds;
    }

    // Contact owner function
    function contactOwner(contact) {
      if (contact.startsWith('http')) {
        window.open(contact, '_blank');
      } else {
        window.open(`tel:${contact}`, '_self');
      }
    }

    // View details function
    function viewDetails(propertyData) {
      try {
        const property = JSON.parse(propertyData);
        alert(`Property Details:\n\nName: ${property.houseName}\nLocation: ${property.location}\nPrice: ₹${property.price}/Month\nBeds: ${property.beds}\nContact: ${property.contact}`);
      } catch (error) {
        console.error('Error viewing details:', error);
      }
    }

    // Event listeners for filters and search
    document.getElementById("searchBtn").addEventListener("click", () => {
      console.log("Search button clicked - applying filters");
      renderProperties(allProperties);
    });

    // Make all filters apply instantly on change
    document.getElementById("propertyType").addEventListener("change", () => {
      console.log("Property type changed to:", document.getElementById("propertyType").value);
      renderProperties(allProperties);
    });

    document.getElementById("priceRange").addEventListener("change", () => {
      console.log("Price range changed to:", document.getElementById("priceRange").value);
      renderProperties(allProperties);
    });

    document.getElementById("beds").addEventListener("change", () => {
      console.log("Beds changed to:", document.getElementById("beds").value);
      renderProperties(allProperties);
    });

    // Search on Enter key
    document.getElementById("searchInput").addEventListener("keypress", (event) => {
      if (event.key === "Enter") {
        console.log("Enter key pressed in search - applying filters");
        renderProperties(allProperties);
      }
    });
    
    // Initialize the page and setup event handlers
    window.addEventListener("DOMContentLoaded", function() {
      fetchAndRenderProperties();
      
      // Setup hamburger menu
      const hamburger = document.getElementById('hamburger');
      if (hamburger) {
        hamburger.addEventListener('click', function() {
          document.getElementById('sideNav').classList.toggle('open');
          this.classList.toggle('active');
        });
      }
      
      // Check if user is logged in
      const navLinks = document.querySelector('.nav-links');
      const loginBtn = document.querySelector('.nav-links button:nth-of-type(2)'); // Login button
      const signupBtn = document.querySelector('.nav-links button:nth-of-type(1)'); // Signup button

      const userName = localStorage.getItem('username');
      const userEmail = getCookie("userEmail");
      const isLoggedIn = getCookie("isLoggedIn");

      if ((userName || userEmail) && isLoggedIn === "true") {
        // Remove Login and Signup buttons
        if (loginBtn) loginBtn.remove();
        if (signupBtn) signupBtn.remove();

        // Create greeting
        const greet = document.createElement('span');
        greet.style.color = '#38bdf8';
        greet.style.fontWeight = '600';
        greet.textContent = `Hello! ${userName || userEmail.split('@')[0]}`;
        navLinks.appendChild(greet);
      }
    });

    function formData() {
      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      const messageInput = document.getElementById('message');

      const nameInputt = document.getElementById('name').value;
      const emailInputt = document.getElementById('email').value;
      const messageInputt = document.getElementById('message').value;
      
      const formData = {
        name: nameInput.value.trim(),
        email: emailInput.value.trim(),
        message: messageInput.value.trim()
      };
     
      
      localStorage.setItem('key', JSON.stringify(formData));
      
      setTimeout(function () {
        const messageDiv = document.getElementById('messageDiv');
         if(!nameInputt || !emailInputt || !messageInputt){
          messageDiv.innerText = 'Please fill in all fields.';
          }
          else{
        messageDiv.innerText = 'Send Message successfully!';
          } 
        messageDiv.style.display = 'block';
        setTimeout(function () {
            messageDiv.style.display = 'none';
        }, 2000);
      }, 500);
    
      // ✅ Clear the inputs
      nameInput.value = '';
      emailInput.value = '';
      messageInput.value = '';
    }
  </script>

</body>
</html>