<!DOCTYPE html>
<html>
    <head>
        <title>web document</title>
    </head>
  <style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

body {
  background: 
    linear-gradient(to right, rgba(0,0,0,0.5), rgba(0,0,0,0.6)),
    url('https://images.unsplash.com/photo-1564013799919-ab600027ffc6?auto=format&fit=crop&w=1950&q=80') no-repeat center center / cover;
  color: white;
}


  /* Background Image with Opacity */
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1;
    width: 100%;
    height: 100%;
    background: url('https://images.unsplash.com/photo-1501183638710-841dd1904471?auto=format&fit=crop&w=1950&q=80') no-repeat center center/cover;
    opacity: 0.3;
    filter: brightness(0.8);
  }

  .loader-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }

  .loader {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255,255,255,0.3);
    border-top: 4px solid #ff6b6b;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading-text {
    margin-top: 20px;
    font-size: 18px;
    color: white;
  }

  nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 5%;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255,255,255,0.2);
    z-index: 1000;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 24px;
    font-weight: bold;
    color: white;
  }

  .logo img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .logo img:hover {
    transform: scale(1.1);
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 30px;
  }

  .nav-links a {
    color: white;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-links a:hover {
    color: #ff6b6b;
  }

  .nav-links a::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background: #ff6b6b;
    transition: width 0.3s ease;
  }

  .nav-links a:hover::after {
    width: 100%;
  }

  .nav-links button {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .nav-links button:hover {
    background: rgba(255,107,107,0.3);
    border-color: #ff6b6b;
    transform: translateY(-2px);
  }

  .user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255,255,255,0.2);
    padding: 8px 20px;
    border-radius: 25px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
    position: relative;
  }

  .user-icon {
    width: 30px;
    height: 30px;
    background: linear-gradient(45deg, #ff6b6b, #ffa500);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
  }

  .dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 10px;
    padding: 10px;
    margin-top: 10px;
    min-width: 120px;
    display: none;
  }

  .user-profile:hover .dropdown {
    display: block;
  }

  .dropdown button {
    background: none;
    border: none;
    color: white;
    padding: 8px 16px;
    cursor: pointer;
    width: 100%;
    text-align: left;
    border-radius: 5px;
    transition: background 0.3s ease;
  }

  .dropdown button:hover {
    background: rgba(255,255,255,0.2);
  }

  .hamburger {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 4px;
  }

  .hamburger div {
    width: 25px;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: 0.3s;
  }

  .side-nav {
    position: fixed;
    top: 0;
    right: -300px;
    width: 300px;
    height: 100vh;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(20px);
    transition: right 0.3s ease;
    z-index: 999;
    padding: 80px 30px 30px;
  }

  .side-nav.open {
    right: 0;
  }

  .side-nav a {
    display: block;
    color: white;
    text-decoration: none;
    padding: 15px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    transition: color 0.3s ease;
  }

  .side-nav a:hover {
    color: #ff6b6b;
  }

  .main-content {
    margin-top: 100px;
    padding: 20px 5%;
  }

  .add-rentout-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: linear-gradient(45deg, #ff6b6b, #ffa500);
    color: white;
    border: none;
    padding: 18px 25px;
    border-radius: 50px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(255,107,107,0.3);
    transition: all 0.3s ease;
    z-index: 100;
  }

  .add-rentout-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(255,107,107,0.4);
  }

  /* Cards Container */
  #cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
    padding: 2rem;
    place-items: center;
  }

  .preview {
    background: rgba(255, 255, 255, 0.9);
    color: #333;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    width: 320px;
    height: 450px;
    transition: transform 0.3s ease;
  }

  .preview:hover {
    transform: scale(1.03);
  }

  .preview img {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .preview-content {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    flex-grow: 1;
    padding: 1rem;
    gap: 6px;
  }

  .preview-content h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.3rem;
    color: #222;
  }

  .preview-content > p {
    margin: 0.2rem 0;
    font-size: 0.95rem;
    color: #444;
  }

  .actions {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: auto;
    padding-bottom: 1rem;
  }

  .actions button {
    margin-right: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .actions button:first-child {
    background: #10b981;
    padding: 8px 25px;
    color: white;
  }

  .actions button:first-child:hover {
    background: #059669;
  }

  .actions button:last-child {
    background: #ef4444;
    color: white;
  }

  .actions button:last-child:hover {
    background: #dc2626;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .nav-links {
      display: none;
    }

    .hamburger {
      display: flex;
    }

    .form-section {
      margin: 20px;
      padding: 30px 20px;
    }

    #cards-container {
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .add-rentout-btn {
      bottom: 20px;
      right: 20px;
      padding: 15px 20px;
    }
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(255,107,107,0.6);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(255,107,107,0.8);
  }
</style>

   <body>
  <!-- Loading animation -->
  <div class="loader-container">
    <div class="loader"></div>
    <div class="loading-text">Loading...</div>
  </div>

  <!-- Navigation -->
  <nav>
    <div class="logo">
      <img title="Home" onclick="window.open('index.html')" src="https://img.freepik.com/premium-psd/modern-house-transparency-background-psd_693425-20565.jpg" alt="Logo" />
      House Rental
    </div>

    <div class="nav-links" id="navLinks">
      <a href="index.html">Home</a>
      <a href="properties.html">Properties</a>
      <a href="about.html">About</a>
      <!-- Dynamic auth buttons will be inserted here -->
    </div>

    <div class="hamburger" id="hamburger">
      <div></div>
      <div></div>
      <div></div>
    </div>
  </nav>

  <!-- Side Menu -->
  <div class="side-nav" id="sideNav">
    <a href="index.html">Home</a>
    <a href="properties.html">Properties</a>
    <a href="about.html">About</a>
    <!-- Dynamic mobile auth options will be inserted here -->
  </div>

  <div class="main-content">
    <!-- Add Rent Out Button -->
    <button class="add-rentout-btn" id="openFormBtn">+ Add Rent Out</button>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay">
      <!-- Form Section -->
      <div class="form-section">
        <button class="close-btn" id="closeFormBtn">âœ–</button>
        <h2 id="heading">ðŸ“‹ Add Rent Out</h2>
        <div class="form-grid">
          <input type="text" id="house-name" class="fancy-input" placeholder="House Name">
          <input type="text" id="location" class="fancy-input" placeholder="Location">
          <input type="number" id="price" class="fancy-input" placeholder="Price">
          <input type="text" id="contact" class="fancy-input" placeholder="Contact Number">
          <input type="number" id="beds" class="fancy-input" placeholder="No. of Beds" min="1">
          
          <div class="file-input-container">
            <label for="image-file" class="file-input-label" id="fileLabel">
              <div class="file-input-text">ðŸ“· Upload House Image</div>
              <div class="file-input-hint">Click to select a photo of your house/property</div>
            </label>
            <input type="file" id="image-file" class="file-input-hidden" accept="image/*">
            <img id="imagePreview" class="file-preview" style="display: none;">
          </div>
          
          <button class="submit-btn" onclick="updateRentout()">Submit</button>
        </div>
      </div>
    </div>

    <!-- Cards Container -->
    <div id="cards-container"></div>
  </div>

  <script>
    const baseUrl = "http://localhost:3000/clients";
    let userId = "";
    let editIndex = null;
    let currentUser = null;
  
    function getUserIdFromCookie() {
      const match = document.cookie.match(/(^| )userId=([^;]+)/);
      return match ? match[2] : null;
    }
  
    function checkLoginStatus() {
      userId = getUserIdFromCookie();
      if (!userId) {
        alert("Session expired. Please login again.");
        window.location.href = "host_login.html";
      }
    }

    // Update navigation based on login status
    async function updateNavigation() {
      const navLinks = document.getElementById('navLinks');
      const sideNav = document.getElementById('sideNav');
      const userId = getUserIdFromCookie();
      
      if (userId) {
        // User is logged in - Replace login button with user profile, keep signup
        const client = await fetchClientData();
        if (client) {
          currentUser = client;
          const userName = client.name || client.email || 'User';
          const userInitial = userName.charAt(0).toUpperCase();
          
          // Update desktop nav - keep signup, replace login with user profile
          navLinks.innerHTML = `
            <a href="index.html">Home</a>
            <a href="properties.html">Properties</a>
            <a href="about.html">About</a>
            <button onclick="window.open('host_signup.html')">Sign Up</button>
            <div class="user-profile">
              <div class="user-icon">${userInitial}</div>
              <span>${userName}</span>
              <div class="dropdown">
                <button onclick="logout()">Logout</button>
              </div>
            </div>
          `;
          
          // Update mobile nav
          sideNav.innerHTML = `
            <a href="index.html">Home</a>
            <a href="properties.html">Properties</a>
            <a href="about.html">About</a>
            <a href="#" onclick="window.open('host_signup.html')">Sign Up</a>
            <a href="#" onclick="logout()" style="color: #ff6b6b;">Logout (${userName})</a>
          `;
        }
      } else {
        // User is not logged in - show both buttons
        navLinks.innerHTML = `
          <a href="index.html">Home</a>
          <a href="properties.html">Properties</a>
          <a href="about.html">About</a>
          <button onclick="window.open('host_signup.html')">Sign Up</button>
          <button onclick="window.open('host_login.html')">Login</button>
        `;
        
        sideNav.innerHTML = `
          <a href="index.html">Home</a>
          <a href="properties.html">Properties</a>
          <a href="about.html">About</a>
          <a href="#" onclick="window.open('host_signup.html')">Sign Up</a>
          <a href="#" onclick="window.open('host_login.html')">Login</a>
        `;
      }
    }

    // Enhanced function to check login before opening form
    function checkLoginAndOpenForm() {
      const currentUserId = getUserIdFromCookie();
      
      if (!currentUserId) {
        // Show login prompt and redirect
        if (confirm("Please login to add rent out properties. Click OK to go to login page.")) {
          window.location.href = "host_login.html";
        }
        return false;
      }
      
      // User is logged in, open the form
      const modalOverlay = document.getElementById('modalOverlay');
      modalOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      clearForm(); // Reset form when opening
      return true;
    }
  
    // Refresh session cookie to last 7 days
    function extendSession() {
      const uid = getUserIdFromCookie();
      if (uid) {
        document.cookie = `userId=${uid}; path=/; max-age=${7 * 24 * 60 * 60}`;
      }
    }
  
    async function fetchClientData() {
      userId = getUserIdFromCookie();
      if (!userId) {
        console.warn("No userId found in cookie.");
        return null;
      }
  
      try {
        const res = await fetch(`${baseUrl}?id=${userId}`);
        const data = await res.json();
        if (data.length === 0) {
          console.warn("No client data found for userId:", userId);
          return null;
        }
        return data[0];
      } catch (error) {
        console.error("Error fetching client data:", error);
        return null;
      }
    }
  
    async function displayRentout() {
      const client = await fetchClientData();
      const container = document.getElementById("cards-container");
      
      if (!client || !Array.isArray(client.rentouts) || client.rentouts.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 50px; color: rgba(255,255,255,0.7);">
            <h3>No rentout properties yet</h3>
            <p>Click the "+ Add Rent Out" button to add your first property!</p>
          </div>
        `;
        return;
      }
  
      container.innerHTML = "";
      client.rentouts.forEach((rentout, index) => {
        const card = document.createElement("div");
        card.className = "preview";
        card.innerHTML = `
          <img src="${rentout.imageUrl}" alt="House Image"/>
          <div class="property-info">
            <h3>${rentout.houseName}</h3>
            <p><strong>Location:</strong> ${rentout.location}</p>
            <p><strong>Price:</strong> â‚¹${rentout.price}</p>
            <p><strong>Contact:</strong> ${rentout.contact}</p>
            <p><strong>Beds:</strong> ${rentout.beds}</p>
          </div>
          <div class="actions">
            <button title='Edit' onclick="editRentout(${index})">Edit</button>
            <button title='Delete' onclick="deleteRentout(${index})">Delete</button>
          </div>
        `;
        container.appendChild(card);
      });
    }
  
    async function updateRentout() {
      const houseName = document.getElementById("house-name").value.trim();
      const location = document.getElementById("location").value.trim();
      const price = document.getElementById("price").value.trim();
      const contact = document.getElementById("contact").value.trim();
      const beds = document.getElementById("beds").value.trim();
      const imageInput = document.getElementById("image-file");
  
      if (!houseName || !location || !price || !contact || !beds || parseInt(beds) < 1) {
        alert("Please fill all fields correctly (beds â‰¥ 1).");
        return;
      }
  
      const client = await fetchClientData();
      if (!client) return;
  
      if (!Array.isArray(client.rentouts)) client.rentouts = [];
  
      const handleSave = async (imageUrl = null) => {
        const rentout = {
          houseName, location, price, contact, beds,
          imageUrl: imageUrl || (editIndex !== null ? client.rentouts[editIndex].imageUrl : "")
        };
  
        if (editIndex !== null) {
          client.rentouts[editIndex] = rentout;
          editIndex = null;
        } else {
          client.rentouts.push(rentout);
        }
  
        await fetch(`${baseUrl}/${client.id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(client)
        });
  
        // Close modal after submission
        document.getElementById('modalOverlay').classList.remove('active');
        document.body.style.overflow = 'auto';
  
        clearForm();
        displayRentout();
      };
  
      if (imageInput.files.length > 0) {
        const reader = new FileReader();
        reader.onloadend = () => handleSave(reader.result);
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        handleSave();
      }
    }
  
    function clearForm() {
      document.getElementById("house-name").value = "";
      document.getElementById("location").value = "";
      document.getElementById("price").value = "";
      document.getElementById("contact").value = "";
      document.getElementById("beds").value = "";
      document.getElementById("image-file").value = "";
      document.querySelector(".submit-btn").textContent = "Submit";
      document.getElementById('heading').innerHTML = 'ðŸ“‹ Add Rent Out';
      
      // Reset file input display
      const fileLabel = document.getElementById('fileLabel');
      const imagePreview = document.getElementById('imagePreview');
      fileLabel.classList.remove('has-file');
      fileLabel.innerHTML = `
        <div class="file-input-text">ðŸ“· Upload House Image</div>
        <div class="file-input-hint">Click to select a photo of your house/property</div>
      `;
      imagePreview.style.display = 'none';
    }

    // File input handling
    function setupFileInput() {
      const fileInput = document.getElementById('image-file');
      const fileLabel = document.getElementById('fileLabel');
      const imagePreview = document.getElementById('imagePreview');
      
      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          // Check if it's an image
          if (!file.type.startsWith('image/')) {
            alert('Please select an image file for your house/property');
            fileInput.value = '';
            return;
          }
          
          // Check file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            alert('Image size should be less than 5MB');
            fileInput.value = '';
            return;
          }
          
          // Show file name and preview
          fileLabel.classList.add('has-file');
          fileLabel.innerHTML = `
            <div class="file-input-text">âœ… ${file.name}</div>
            <div class="file-input-hint">Click to change house image</div>
          `;
          
          // Show image preview
          const reader = new FileReader();
          reader.onload = function(e) {
            imagePreview.src = e.target.result;
            imagePreview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      });
    }
  
    async function editRentout(index) {
      const client = await fetchClientData();
      if (!client || !Array.isArray(client.rentouts)) return;
  
      const rentout = client.rentouts[index];
      document.getElementById("house-name").value = rentout.houseName;
      document.getElementById("location").value = rentout.location;
      document.getElementById("price").value = rentout.price;
      document.getElementById("contact").value = rentout.contact;
      document.getElementById("beds").value = rentout.beds;
      editIndex = index;
      document.getElementById('heading').innerHTML = 'ðŸ“‹ Edit Rent Out';
      document.querySelector(".submit-btn").textContent = "Update";
      
      // Open the modal for editing
      document.getElementById('modalOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
  
    async function deleteRentout(index) {
      if (!confirm("Are you sure you want to delete this property?")) return;
      
      const client = await fetchClientData();
      if (!client || !Array.isArray(client.rentouts)) return;
  
      client.rentouts.splice(index, 1);
  
      await fetch(`${baseUrl}/${client.id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(client)
      });
  
      displayRentout();
    }
  
    function logout() {
      if (confirm("Are you sure you want to logout?")) {
        document.cookie = "userId=; path=/; max-age=0";
        window.location.href = "host_login.html";
      }
    }
  
    // Modal functionality
    document.addEventListener('DOMContentLoaded', async function() {
      // Show loading animation for 1 second
      setTimeout(function() {
        document.querySelector('.loader-container').style.display = 'none';
      }, 1000);
      
      // Initialize navigation
      await updateNavigation();
      
      // Setup file input functionality
      setupFileInput();
      
      // Modal controls
      const openFormBtn = document.getElementById('openFormBtn');
      const closeFormBtn = document.getElementById('closeFormBtn');
      const modalOverlay = document.getElementById('modalOverlay');
      
      openFormBtn.addEventListener('click', function() {
        checkLoginAndOpenForm();
      });
      
      closeFormBtn.addEventListener('click', function() {
        modalOverlay.classList.remove('active');
        document.body.style.overflow = 'auto';
        clearForm();
        editIndex = null;
      });
      
      // Close when clicking outside the form
      modalOverlay.addEventListener('click', function(e) {
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove('active');
          document.body.style.overflow = 'auto';
          clearForm();
          editIndex = null;
        }
      });
      
      // Hamburger menu
      document.getElementById('hamburger').addEventListener('click', function () {
        document.getElementById('sideNav').classList.toggle('open');
        this.classList.toggle('active');
      });
      extendSession();
      setInterval(checkLoginStatus, 60000); // check every minute
      displayRentout();
    });
  </script>
</body>
</html>